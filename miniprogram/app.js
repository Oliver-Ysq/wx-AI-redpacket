"use strict";
var fetchWechat = require("fetch-wechat");
var tf = require("@tensorflow/tfjs-core");
var plugin = requirePlugin("tfjsPlugin");
var webgl = require("@tensorflow/tfjs-backend-webgl");
var cpu = require("@tensorflow/tfjs-backend-cpu");
App({
    globalData: {
        Width: 320,
        Height: 500,
        benchmarkLevel: -1,
        baseLengthRatio: 1,
        localStorageIO: plugin.localStorageIO,
        fileStorageIO: plugin.fileStorageIO,
        activeType: 0,
        typeList: ["画图", "表情", "识物", "动作"],
        baseUrl: "https://mp.weixin.qq.com/airedpacket",
        canvasModel: null,
        actionModel: null,
    },
    login() {
        const that = this;
        return new Promise((resolve, reject) => {
            wx.login({
                success: (res) => {
                    wx.request({
                        url: "https://mp.weixin.qq.com/airedpacket/action?action=login",
                        method: "POST",
                        header: {
                            "content-type": "application/json; charset=UTF-8",
                        },
                        data: { code: res.code },
                        success(res) {
                            console.log(res.data);
                            that.globalData.sessionid = res.data.session_id;
                            resolve(that.globalData.sessionid);
                        },
                        fail(err) {
                            console.log("app login 获取失败");
                            reject(err);
                        },
                    });
                },
                fail(err) {
                    console.log(err, "wx.login 获取失败");
                },
            });
        });
    },
    getuserinfo() {
        return new Promise((resolve, reject) => {
            const that = this;
            wx.getSetting({
                success: (res) => {
                    if (res.authSetting["scope.userInfo"]) {
                        wx.getUserInfo({
                            success: (res) => {
                                that.globalData.userInfo = res.userInfo;
                                resolve(res.userInfo);
                            },
                        });
                    }
                    else
                        reject();
                },
            });
        });
    },
    downLoadFile(url, key) {
        if (!!wx.getStorageSync(key))
            return;
        wx.downloadFile({
            url,
            success: (res) => {
                if (res.statusCode === 200) {
                    const fs = wx.getFileSystemManager();
                    fs.saveFile({
                        tempFilePath: res.tempFilePath,
                        success(res) {
                            console.log("缓存成功", res.savedFilePath);
                            wx.setStorageSync(key, res.savedFilePath);
                        },
                    });
                }
                else
                    console.log("响应失败", res.statusCode);
            },
            fail: (err) => console.log("下载失败", err),
        });
    },
    getSessionId() {
        const that = this;
        return new Promise((resolve, reject) => {
            const sessionid = wx.getStorageSync("sessionId");
            if (!sessionid) {
                console.log("sessionid缓存miss");
                this.login().then((res) => {
                    wx.setStorage({
                        key: "sessionId",
                        data: res
                    });
                    that.globalData.sessionid = res;
                    reject(res);
                });
            }
            else {
                console.log("sessionid缓存命中");
                this.globalData.sessionid = sessionid;
                resolve(sessionid);
            }
        });
    },
    getDeviceInfo() {
        try {
            const res = wx.getSystemInfoSync();
            this.globalData.baseLengthRatio =
                Math.min(res.windowHeight, res.windowWidth) / 443;
            this.globalData.appHeight = res.windowHeight;
            this.globalData.appWidth = res.windowWidth;
            this.globalData.Width =
                typeof res.screenWidth === "number" ? res.screenWidth : 320;
            this.globalData.Height =
                typeof res.screenHeight === "number" ? res.screenHeight : 500;
            this.globalData.benchmarkLevel =
                typeof res.benchmarkLevel === "number"
                    ? res.benchmarkLevel
                    : -1;
            wx.reportAnalytics("get_device_info", {
                device_info: JSON.stringify(res),
            });
        }
        catch (e) {
            console.log(e);
        }
    },
    onLaunch() {
        const that = this;
        this.getDeviceInfo();
        plugin.configPlugin({
            fetchFunc: fetchWechat.fetchFunc(),
            tf,
            webgl,
            cpu,
            canvas: wx.createOffscreenCanvas(),
        }, false);
        this.downLoadFile("https://weixinredpacket-1258344707.file.myqcloud.com/mobilenet/static/loginBG.svg", "loginBg");
        this.downLoadFile("https://weixinredpacket-1258344707.file.myqcloud.com/mobilenet/static/draw.svg", "draw_img");
        this.downLoadFile("https://weixinredpacket-1258344707.file.myqcloud.com/mobilenet/static/emotion.svg", "emotion_img");
        this.downLoadFile("https://weixinredpacket-1258344707.file.myqcloud.com/mobilenet/static/scan.svg", "scan_img");
        this.downLoadFile("https://weixinredpacket-1258344707.file.myqcloud.com/mobilenet/static/action.svg", "action_img");
        this.downLoadFile("https://weixinredpacket-1258344707.file.myqcloud.com/mobilenet/static/zhuanfa.svg", "zhuanfa");
        setTimeout(() => {
            setInterval(() => {
                that.login().then(res => {
                    wx.setStorage({
                        key: "sessionId",
                        data: res
                    });
                    that.globalData.sessionid = res;
                });
            }, 25 * 60 * 1000);
        }, 1 * 60 * 1000);
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7QUFDMUMsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFDMUMsSUFBSSxNQUFNLEdBQUcsYUFBYSxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3pDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQ3RELElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBNEJsRCxHQUFHLENBQU87SUFFTixVQUFVLEVBQUU7UUFDUixLQUFLLEVBQUUsR0FBRztRQUNWLE1BQU0sRUFBRSxHQUFHO1FBQ1gsY0FBYyxFQUFFLENBQUMsQ0FBQztRQUNsQixlQUFlLEVBQUUsQ0FBQztRQUVsQixjQUFjLEVBQUUsTUFBTSxDQUFDLGNBQWM7UUFDckMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxhQUFhO1FBRW5DLFVBQVUsRUFBRSxDQUFDO1FBQ2IsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1FBRWxDLE9BQU8sRUFBRSxzQ0FBc0M7UUFFL0MsV0FBVyxFQUFFLElBQUk7UUFDakIsV0FBVyxFQUFFLElBQUk7S0FDcEI7SUFFRCxLQUFLO1FBQ0QsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7WUFDbkMsRUFBRSxDQUFDLEtBQUssQ0FBQztnQkFDTCxPQUFPLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRTtvQkFDYixFQUFFLENBQUMsT0FBTyxDQUFDO3dCQUNQLEdBQUcsRUFBRSwwREFBMEQ7d0JBRS9ELE1BQU0sRUFBRSxNQUFNO3dCQUNkLE1BQU0sRUFB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QUFnRixFQUNoRixVQUFVLENBQ2IsQ0FBQztRQUNGLElBQUksQ0FBQyxZQUFZLENBQ2Isa0ZBQWtGLEVBQ2xGLFlBQVksQ0FDZixDQUFDO1FBRUYsSUFBSSxDQUFDLFlBQVksQ0FDYixtRkFBbUYsRUFDbkYsU0FBUyxDQUNaLENBQUM7UUFDRixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ1osV0FBVyxDQUFDLEdBQUcsRUFBRTtnQkFDYixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFO29CQUNwQixFQUFFLENBQUMsVUFBVSxDQUFDO3dCQUNWLEdBQUcsRUFBRSxXQUFXO3dCQUNoQixJQUFJLEVBQUUsR0FBRztxQkFDWixDQUFDLENBQUM7b0JBQ0gsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDO2dCQUNwQyxDQUFDLENBQUMsQ0FBQTtZQUNOLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ3RCLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFBO0lBQ3JCLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyAvLyBhcHAudHNcbnZhciBmZXRjaFdlY2hhdCA9IHJlcXVpcmUoXCJmZXRjaC13ZWNoYXRcIik7XG52YXIgdGYgPSByZXF1aXJlKFwiQHRlbnNvcmZsb3cvdGZqcy1jb3JlXCIpO1xudmFyIHBsdWdpbiA9IHJlcXVpcmVQbHVnaW4oXCJ0ZmpzUGx1Z2luXCIpO1xudmFyIHdlYmdsID0gcmVxdWlyZShcIkB0ZW5zb3JmbG93L3RmanMtYmFja2VuZC13ZWJnbFwiKTtcbnZhciBjcHUgPSByZXF1aXJlKFwiQHRlbnNvcmZsb3cvdGZqcy1iYWNrZW5kLWNwdVwiKTtcblxuaW50ZXJmYWNlIElBcHAge1xuICAgIGdsb2JhbERhdGE6IHtcbiAgICAgICAgdXNlckluZm8/OiBhbnk7XG4gICAgICAgIGFwcFdpZHRoPzogbnVtYmVyO1xuICAgICAgICBhcHBIZWlnaHQ/OiBudW1iZXI7XG4gICAgICAgIFdpZHRoOiBudW1iZXI7XG4gICAgICAgIEhlaWdodDogbnVtYmVyO1xuICAgICAgICBiZW5jaG1hcmtMZXZlbDogbnVtYmVyO1xuICAgICAgICBiYXNlTGVuZ3RoUmF0aW86IG51bWJlcjtcbiAgICAgICAgbG9jYWxTdG9yYWdlSU86IGFueTtcbiAgICAgICAgZmlsZVN0b3JhZ2VJTzogYW55O1xuICAgICAgICBhY3RpdmVUeXBlOiBudW1iZXI7XG4gICAgICAgIHR5cGVMaXN0OiBzdHJpbmdbXTtcbiAgICAgICAgYmFzZVVybDogc3RyaW5nO1xuICAgICAgICBjYW52YXNNb2RlbDogYW55O1xuICAgICAgICBhY3Rpb25Nb2RlbDogYW55O1xuICAgICAgICBzZXNzaW9uaWQ/OiBzdHJpbmc7XG4gICAgfTtcbiAgICBvbkxhdW5jaDogKCkgPT4gdm9pZDtcbiAgICBsb2dpbjogKCkgPT4gUHJvbWlzZTxhbnk+O1xuICAgIGdldFNlc3Npb25JZDogKCkgPT4gUHJvbWlzZTxhbnk+O1xuICAgIGdldERldmljZUluZm86ICgpID0+IHZvaWQ7XG4gICAgZ2V0dXNlcmluZm86ICgpID0+IFByb21pc2U8YW55PjtcbiAgICBkb3duTG9hZEZpbGU6ICh1cmw6IHN0cmluZywga2V5OiBzdHJpbmcpID0+IHZvaWQ7XG59XG5cbkFwcDxJQXBwPih7XG4gICAgLy/lhajlsYDlsZ7mgKdcbiAgICBnbG9iYWxEYXRhOiB7XG4gICAgICAgIFdpZHRoOiAzMjAsXG4gICAgICAgIEhlaWdodDogNTAwLFxuICAgICAgICBiZW5jaG1hcmtMZXZlbDogLTEsXG4gICAgICAgIGJhc2VMZW5ndGhSYXRpbzogMSxcblxuICAgICAgICBsb2NhbFN0b3JhZ2VJTzogcGx1Z2luLmxvY2FsU3RvcmFnZUlPLCAvL+mFjee9ruaooeWei+e8k+WtmFxuICAgICAgICBmaWxlU3RvcmFnZUlPOiBwbHVnaW4uZmlsZVN0b3JhZ2VJTywgLy/mqKHlnovkuIvovb1cblxuICAgICAgICBhY3RpdmVUeXBlOiAwLFxuICAgICAgICB0eXBlTGlzdDogW1wi55S75Zu+XCIsIFwi6KGo5oOFXCIsIFwi6K+G54mpXCIsIFwi5Yqo5L2cXCJdLFxuICAgICAgICAvLyBiYXNlVXJsOiBcImh0dHA6Ly8xMDAuMTEyLjE3LjIzNjo4MDgxL2FpcmVkcGFja2V0XCIsXG4gICAgICAgIGJhc2VVcmw6IFwiaHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL2FpcmVkcGFja2V0XCIsXG5cbiAgICAgICAgY2FudmFzTW9kZWw6IG51bGwsXG4gICAgICAgIGFjdGlvbk1vZGVsOiBudWxsLFxuICAgIH0sXG4gICAgLy/nmbvlvZXojrflj5ZzZXNzaW9uaWRcbiAgICBsb2dpbigpIHtcbiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB3eC5sb2dpbih7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB3eC5yZXF1ZXN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwczovL21wLndlaXhpbi5xcS5jb20vYWlyZWRwYWNrZXQvYWN0aW9uP2FjdGlvbj1sb2dpblwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXJsOiBcImh0dHA6Ly8xMDAuMTEyLjE3LjIzNjo4MDgxL2FpcmVkcGFja2V0L2FjdGlvbj9hY3Rpb249bG9naW5cIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNvbnRlbnQtdHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLThcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGNvZGU6IHJlcy5jb2RlIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKHJlczogQW55UmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoYXQuZ2xvYmFsRGF0YS5zZXNzaW9uaWQgPSByZXMuZGF0YS5zZXNzaW9uX2lkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUodGhhdC5nbG9iYWxEYXRhLnNlc3Npb25pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImFwcCBsb2dpbiDojrflj5blpLHotKVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWwoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyciwgXCJ3eC5sb2dpbiDojrflj5blpLHotKVcIik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy/mn6Xor6LnlKjmiLfkv6Hmga/vvJp1c2VyaW5mb1xuICAgIGdldHVzZXJpbmZvKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgICAgICAgICB3eC5nZXRTZXR0aW5nKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuYXV0aFNldHRpbmdbXCJzY29wZS51c2VySW5mb1wiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bey57uP5o6I5p2D77yM5Y+v5Lul55u05o6l6LCD55SoIGdldFVzZXJJbmZvIOiOt+WPluWktOWDj+aYteensO+8jOS4jeS8muW8ueahhlxuICAgICAgICAgICAgICAgICAgICAgICAgd3guZ2V0VXNlckluZm8oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5Y+v5Lul5bCGIHJlcyDlj5HpgIHnu5nlkI7lj7Dop6PnoIHlh7ogdW5pb25JZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGF0Lmdsb2JhbERhdGEudXNlckluZm8gPSByZXMudXNlckluZm87XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzLnVzZXJJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSByZWplY3QoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvL+e8k+WtmOaWh+S7tlxuICAgIGRvd25Mb2FkRmlsZSh1cmwsIGtleSkge1xuICAgICAgICBpZiAoISF3eC5nZXRTdG9yYWdlU3luYyhrZXkpKSByZXR1cm47XG4gICAgICAgIHd4LmRvd25sb2FkRmlsZSh7XG4gICAgICAgICAgICB1cmwsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZnMgPSB3eC5nZXRGaWxlU3lzdGVtTWFuYWdlcigpOyAvLyDkvb/nlKjlsI/nqIvluo/nmoTmlofku7bns7vnu5/vvIzpgJrov4flsI/nqIvluo/nmoRhcGnojrflj5bliLDlhajlsYDllK/kuIDnmoTmlofku7bnrqHnkIblmahcbiAgICAgICAgICAgICAgICAgICAgZnMuc2F2ZUZpbGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcEZpbGVQYXRoOiByZXMudGVtcEZpbGVQYXRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyhyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIue8k+WtmOaIkOWKn1wiLCByZXMuc2F2ZWRGaWxlUGF0aCk7IC8vIHJlcy5zYXZlZEZpbGVQYXRoIOS4uuS4gOS4quacrOWcsOe8k+WtmOaWh+S7tui3r+W+hFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKGtleSwgcmVzLnNhdmVkRmlsZVBhdGgpOyAvLyDmraTml7blm77niYfmnKzlnLDnvJPlrZjlt7Lnu4/lrozmiJDvvIxyZXMuc2F2ZWRGaWxlUGF0aOS4uuacrOWcsOWtmOWCqOeahOi3r+W+hOOAglxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGNvbnNvbGUubG9nKFwi5ZON5bqU5aSx6LSlXCIsIHJlcy5zdGF0dXNDb2RlKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWlsOiAoZXJyKSA9PiBjb25zb2xlLmxvZyhcIuS4i+i9veWksei0pVwiLCBlcnIpLFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgLy8g5p+l5om+c2Vzc2lvbmlk77yaIOe8k+WtmCB8fCB3eC5sb2dpblxuICAgIGdldFNlc3Npb25JZCgpIHtcbiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZXNzaW9uaWQgPSB3eC5nZXRTdG9yYWdlU3luYyhcInNlc3Npb25JZFwiKTtcbiAgICAgICAgICAgIGlmICghc2Vzc2lvbmlkKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZXNzaW9uaWTnvJPlrZhtaXNzXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMubG9naW4oKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IFwic2Vzc2lvbklkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2xvYmFsRGF0YS5zZXNzaW9uaWQgPSByZXM7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInNlc3Npb25pZOe8k+WtmOWRveS4rVwiKTtcbiAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuc2Vzc2lvbmlkID0gc2Vzc2lvbmlkO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoc2Vzc2lvbmlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8v5p+l6K+i6K6+5aSH5L+h5oGvXG4gICAgZ2V0RGV2aWNlSW5mbygpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IHd4LmdldFN5c3RlbUluZm9TeW5jKCk7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuYmFzZUxlbmd0aFJhdGlvID1cbiAgICAgICAgICAgICAgICBNYXRoLm1pbihyZXMud2luZG93SGVpZ2h0LCByZXMud2luZG93V2lkdGgpIC8gNDQzOyAvL+mAgumFjeeslOeUu+mVv+W6plxuICAgICAgICAgICAgdGhpcy5nbG9iYWxEYXRhLmFwcEhlaWdodCA9IHJlcy53aW5kb3dIZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuYXBwV2lkdGggPSByZXMud2luZG93V2lkdGg7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuV2lkdGggPVxuICAgICAgICAgICAgICAgIHR5cGVvZiByZXMuc2NyZWVuV2lkdGggPT09IFwibnVtYmVyXCIgPyByZXMuc2NyZWVuV2lkdGggOiAzMjA7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuSGVpZ2h0ID1cbiAgICAgICAgICAgICAgICB0eXBlb2YgcmVzLnNjcmVlbkhlaWdodCA9PT0gXCJudW1iZXJcIiA/IHJlcy5zY3JlZW5IZWlnaHQgOiA1MDA7XG4gICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuYmVuY2htYXJrTGV2ZWwgPVxuICAgICAgICAgICAgICAgIHR5cGVvZiByZXMuYmVuY2htYXJrTGV2ZWwgPT09IFwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICAgICAgPyByZXMuYmVuY2htYXJrTGV2ZWxcbiAgICAgICAgICAgICAgICAgICAgOiAtMTtcbiAgICAgICAgICAgIHd4LnJlcG9ydEFuYWx5dGljcyhcImdldF9kZXZpY2VfaW5mb1wiLCB7XG4gICAgICAgICAgICAgICAgZGV2aWNlX2luZm86IEpTT04uc3RyaW5naWZ5KHJlcyksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25MYXVuY2goKSB7XG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzXG4gICAgICAgIHRoaXMuZ2V0RGV2aWNlSW5mbygpO1xuXG4gICAgICAgIHBsdWdpbi5jb25maWdQbHVnaW4oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZmV0Y2hGdW5jOiBmZXRjaFdlY2hhdC5mZXRjaEZ1bmMoKSxcbiAgICAgICAgICAgICAgICB0ZixcbiAgICAgICAgICAgICAgICB3ZWJnbCxcbiAgICAgICAgICAgICAgICBjcHUsXG4gICAgICAgICAgICAgICAgY2FudmFzOiB3eC5jcmVhdGVPZmZzY3JlZW5DYW52YXMoKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmYWxzZVxuICAgICAgICApO1xuXG4gICAgICAgIC8vICDnvJPlrZjlm77niYfvvJpcbiAgICAgICAgLy8gIOeZu+W9leiDjOaZr1xuICAgICAgICB0aGlzLmRvd25Mb2FkRmlsZShcbiAgICAgICAgICAgIFwiaHR0cHM6Ly93ZWl4aW5yZWRwYWNrZXQtMTI1ODM0NDcwNy5maWxlLm15cWNsb3VkLmNvbS9tb2JpbGVuZXQvc3RhdGljL2xvZ2luQkcuc3ZnXCIsXG4gICAgICAgICAgICBcImxvZ2luQmdcIlxuICAgICAgICApO1xuICAgICAgICAvLyAgcmVjZWl2ZemhtemdouWbvuagh1xuICAgICAgICB0aGlzLmRvd25Mb2FkRmlsZShcbiAgICAgICAgICAgIFwiaHR0cHM6Ly93ZWl4aW5yZWRwYWNrZXQtMTI1ODM0NDcwNy5maWxlLm15cWNsb3VkLmNvbS9tb2JpbGVuZXQvc3RhdGljL2RyYXcuc3ZnXCIsXG4gICAgICAgICAgICBcImRyYXdfaW1nXCJcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5kb3duTG9hZEZpbGUoXG4gICAgICAgICAgICBcImh0dHBzOi8vd2VpeGlucmVkcGFja2V0LTEyNTgzNDQ3MDcuZmlsZS5teXFjbG91ZC5jb20vbW9iaWxlbmV0L3N0YXRpYy9lbW90aW9uLnN2Z1wiLFxuICAgICAgICAgICAgXCJlbW90aW9uX2ltZ1wiXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuZG93bkxvYWRGaWxlKFxuICAgICAgICAgICAgXCJodHRwczovL3dlaXhpbnJlZHBhY2tldC0xMjU4MzQ0NzA3LmZpbGUubXlxY2xvdWQuY29tL21vYmlsZW5ldC9zdGF0aWMvc2Nhbi5zdmdcIixcbiAgICAgICAgICAgIFwic2Nhbl9pbWdcIlxuICAgICAgICApO1xuICAgICAgICB0aGlzLmRvd25Mb2FkRmlsZShcbiAgICAgICAgICAgIFwiaHR0cHM6Ly93ZWl4aW5yZWRwYWNrZXQtMTI1ODM0NDcwNy5maWxlLm15cWNsb3VkLmNvbS9tb2JpbGVuZXQvc3RhdGljL2FjdGlvbi5zdmdcIixcbiAgICAgICAgICAgIFwiYWN0aW9uX2ltZ1wiXG4gICAgICAgICk7XG4gICAgICAgIC8vIHJlY2VpdmXpobXovazlj5Hlm77moIdcbiAgICAgICAgdGhpcy5kb3duTG9hZEZpbGUoXG4gICAgICAgICAgICBcImh0dHBzOi8vd2VpeGlucmVkcGFja2V0LTEyNTgzNDQ3MDcuZmlsZS5teXFjbG91ZC5jb20vbW9iaWxlbmV0L3N0YXRpYy96aHVhbmZhLnN2Z1wiLFxuICAgICAgICAgICAgXCJ6aHVhbmZhXCJcbiAgICAgICAgKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhhdC5sb2dpbigpLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3guc2V0U3RvcmFnZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk6IFwic2Vzc2lvbklkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXNcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoYXQuZ2xvYmFsRGF0YS5zZXNzaW9uaWQgPSByZXM7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0sIDI1ICogNjAgKiAxMDAwKSAgLy/mr4/pmpQyNeWIhumSn+WIt+aWsOS4gOasoXNlc3Npb25JZFxuICAgICAgICB9LCAxICogNjAgKiAxMDAwKSAgIC8vMeWIhumSn+WQjuW8gOWni+WIt+aWsHNlc3Npb25JZFxuICAgIH0sXG59KTtcbiJdfQ==